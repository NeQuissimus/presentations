<section class="slide level1">

<p>footer: Â© Tim Steinbach, 2016 slidenumbers: true</p>
</section>
<section id="refined-types" class="slide level1">
<h1>Refined Types</h1>
<h4 id="tim-steinbach"><a href="http://nequissimus.com">Tim Steinbach</a></h4>
</section>
<section class="slide level1">

<h3 id="types">Types</h3>
<ul>
<li class="fragment">Int</li>
<li class="fragment">String</li>
<li class="fragment">Char</li>
</ul>
</section>
<section class="slide level1">

<h3 id="range-checks-1">Range checks (1)</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">case</span> <span class="kw">class</span> <span class="fu">IntLess5</span>(i: Int) {
    <span class="fu">require</span>(i &lt; <span class="dv">5</span>, <span class="st">&quot;value is too large&quot;</span>)
}</code></pre></div>
<figure>
<img src="./exception.jpg" alt="left fit" /><figcaption>left fit</figcaption>
</figure>
</section>
<section class="slide level1">

<h3 id="range-checks-2">Range checks (2)</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">IntLess5</span>(i: Int)
<span class="kw">object</span> IntLess5 { <span class="kw">def</span> <span class="fu">apply</span>(i: Int): Option[IntLess5] = Some(i).<span class="fu">filter</span>(_ &lt; <span class="dv">5</span>).<span class="fu">map</span>(<span class="kw">new</span> <span class="fu">IntLess5</span>(_)) }</code></pre></div>
<figure>
<img src="./factory.jpg" alt="left fit" /><figcaption>left fit</figcaption>
</figure>
</section>
<section class="slide level1">

<h3 id="object-wrappers">Object wrappers</h3>
<ul>
<li class="fragment">Runtime hit</li>
<li class="fragment">Composition?</li>
</ul>
</section>
<section class="slide level1">

<h3 id="composition">Composition</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">class</span> <span class="fu">IntLess5</span>(i: Int)
<span class="kw">class</span> <span class="fu">IntLess10</span>(i: Int)

<span class="kw">def</span> ohoh: IntLess10 = <span class="fu">IntLess5</span>(<span class="dv">3</span>) <span class="co">// Compile error!</span></code></pre></div>
</section>
<section class="slide level1">

<h3 id="refined-types-1">Refined types (1)</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">type</span> IntLess5 = Int Refined Less[W.`<span class="dv">5</span>`.<span class="fu">T</span>]
<span class="kw">type</span> IntLess10 = Int Refined Less[W.`<span class="dv">10</span>`.<span class="fu">T</span>]</code></pre></div>
</section>
<section class="slide level1">

<h3 id="refined-types-2">Refined types (2)</h3>
<ul>
<li class="fragment">Purely runtime</li>
<li class="fragment">Type aliases, not actual types</li>
<li class="fragment">Checked using macros (essentially code run during compile time)</li>
</ul>
</section>
<section class="slide level1">

<h3 id="refined-types-3">Refined types (3)</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> x: IntLess5 = <span class="dv">4</span>
<span class="kw">val</span> y: IntLess10 = x
<span class="kw">val</span> z: IntLess5 = <span class="dv">6</span> <span class="co">// Compile error, type mismatch</span></code></pre></div>
</section>
<section class="slide level1">

<h3 id="runtime-input-1">Runtime input (1)</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> i: Int = restApi.<span class="fu">get</span>(<span class="st">&quot;/api/v1/foo&quot;</span>)
<span class="co">// Now what?</span></code></pre></div>
</section>
<section class="slide level1">

<h3 id="runtime-input-2">Runtime input (2)</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> i: Int = restApi.<span class="fu">get</span>(<span class="st">&quot;/api/v1/foo&quot;</span>)
<span class="kw">val</span> refined: Either[String, IntLess5] = refineV[IntLess5](i)

<span class="co">// Either is right-biased</span>
<span class="co">// will be Left(&quot;Predicate failed: (X &lt; 5).&quot;)</span>
<span class="co">// or Right(X)</span></code></pre></div>
</section>
<section class="slide level1">

<h3 id="runtime-input-3">Runtime input (3)</h3>
<ul>
<li class="fragment">Push universal types to the outside of your application</li>
<li class="fragment">Pass refined types with strong guarantees around</li>
<li class="fragment">No need for most constaint-checking if expressions</li>
<li class="fragment">Allows for arbitrarily complex combinators, validation</li>
</ul>
</section>
<section class="slide level1">

<h3 id="ints-are-boring-1">Ints are boring! (1)</h3>
<figure>
<img src="./professional.jpg" alt="left fit" /><figcaption>left fit</figcaption>
</figure>
</section>
<section class="slide level1">

<h3 id="ints-are-boring-2">Ints are boring! (2)</h3>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala"><span class="kw">val</span> x = refineMV[AnyOf[Digit :: Letter :: Whitespace :: HNil]](&#39;F&#39;)
x: Char Refined AnyOf[Digit :: Letter :: Whitespace :: HNil] = F

<span class="kw">val</span> r1: String Refined Regex = <span class="st">&quot;(a|b)&quot;</span>
r1: String Refined Regex = (a|b)

<span class="kw">val</span> r2: String Refined Regex = <span class="st">&quot;(a|b&quot;</span>
error: Regex predicate failed: Unclosed group near index <span class="dv">4</span>

<span class="kw">val</span> u1: String Refined Url = <span class="st">&quot;htp://example.com&quot;</span>
error: Url predicate failed: unknown protocol: htp

<span class="kw">type</span> ZeroToOne = Not[Less[W.`<span class="fl">0.0</span>`.<span class="fu">T</span>]] And Not[Greater[W.`<span class="fl">1.0</span>`.<span class="fu">T</span>]]
defined <span class="kw">type</span> alias ZeroToOne</code></pre></div>
</section>
<section id="thank-you" class="slide level1">
<h1>Thank you</h1>
<figure>
<img src="./refined.jpg" alt="left fit" /><figcaption>left fit</figcaption>
</figure>
</section>
<section class="slide level1">

<p><a href="https://github.com/fthomas/refined">Refined</a></p>
</section>
